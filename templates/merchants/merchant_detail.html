{% extends 'base.html' %}

{% block title %}{{ merchant.name }} - KantinKu{% endblock %}

{% block content %}
{% csrf_token %}
<div class="bg-white">
    <!-- Merchant Header -->
    <div class="relative">
        <div class="absolute inset-0">
            <img class="w-full h-96 object-cover"  src="{% if merchant.image %}{{ merchant.image.url }}{% else %}https://placehold.co/600x400{% endif %}"  alt="{{ merchant.name }}">
            <div class="absolute inset-0 bg-gray-500 mix-blend-multiply"></div>
        </div>
        <div class="relative max-w-7xl mx-auto py-24 px-4 sm:py-32 sm:px-6 lg:px-8">
            <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl lg:text-6xl">{{ merchant.name }}</h1>
            <p class="mt-6 text-xl text-white max-w-3xl">{{ merchant.description }}</p>
        </div>
    </div>

    <!-- Menu Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Category Tabs -->
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                {% for category, items in menu_by_category.items %}
                <a href="#category-{{ category.id }}" 
                   class="{% if forloop.first %}border-primary text-primary{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %}
                          whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    {{ category.name }}
                </a>
                {% endfor %}
            </nav>
        </div>

        <!-- Menu Items by Category -->
        {% for category, items in menu_by_category.items %}
        <div id="category-{{ category.id }}" class="py-12">
            <h2 class="text-2xl font-bold text-gray-900">{{ category.name }}</h2>
            <div class="mt-8 grid gap-8 md:grid-cols-2 lg:grid-cols-3">
                {% for item in items %}
                <div class="relative flex flex-col bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="flex-shrink-0">
                        <img class="h-48 w-full object-cover"  src="{% if item.image %}{{ item.image.url }}{% else %}https://placehold.co/600x400{% endif %}"
                        alt="{{ item.name }}">
                    </div>
                    <div class="flex-1 p-6 flex flex-col justify-between">
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-gray-900">{{ item.name }}</h3>
                            <p class="mt-3 text-base text-gray-500">{{ item.description }}</p>
                        </div>
                        <div class="mt-6 flex items-center justify-between">
                            <p class="text-xl font-semibold text-gray-900">Rp {{ item.price|floatformat:0 }}</p>
                            <button onclick="addToCart({{ item.id }})" 
                                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                Tambah ke Keranjang
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% block extra_js %}

{% csrf_token %}
<script>
function addToCart(itemId) {
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    fetch(`/orders/cart/add/${itemId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            quantity: 1
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                cartCount.textContent = data.cart_count;
            }
            alert('Berhasil ditambahkan ke keranjang!');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Gagal menambahkan ke keranjang');
    });
}
</script>


{% endblock %}
{% endblock %}